function [y1] = myNeuralNetworkFunction(x1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Jul-2018 19:04:05.
%
% [y1] = myNeuralNetworkFunction(x1) takes these arguments:
%   x = Qx48 matrix, input #1
% and returns:
%   y = Qx3 matrix, output #1
% where Q is the number of samples.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-571.00794;513.54247;6.241333;-5.572068;2.626933;1.620782;2.184814;22.661475;-187.460096;882.058543;6.782258;-1.768491;7.450447;2.729551;3.679434;29.69947;41.529393;1456.918444;7.284079;0.381004;9.932949;3.151658;4.248435;38.169601;-132.706312;17.061981;2.836853;-1.23528;0.132039;0.363371;0.489824;4.130615;-37.877217;123.799611;4.818664;-0.407282;1.111458;1.054257;1.421138;11.126527;-1.985819;65.750959;4.185874;-0.021585;0.554214;0.744456;1.003526;8.108697];
x1_step1.gain = [0.00195170157296315;0.000310919701646529;0.767872520875574;0.203819205027649;0.0608317149309041;0.461064806116486;0.342036216846857;0.0329589091392089;0.00266403959328678;0.000292523647845711;0.922000168726031;0.303838744270931;0.0618436475704924;0.558911196276757;0.414622491404357;0.0343884802305184;0.00682280473358005;0.000413195258267656;1.36631713997031;0.776875221409438;0.0346301187319593;0.394049769668058;0.292321759730222;0.0485606832021944;0.00874280321399959;0.00307717742694095;0.545561326685123;0.937657936758723;0.432748877124851;1.10076574769238;0.816591506223448;0.0921833667282943;0.0144663522159085;0.00388204455749407;1.21859973142062;1.48270169005752;0.490974176231253;1.63558911057482;1.21334485202046;0.141325127996402;0.0201235766707416;0.00269303690921673;0.797069335467354;2.29243176576849;0.375754515066253;1.19064415634825;0.883266992621629;0.0984067891631098];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.996462269790007;1.059615242345328;0.78654341528241678;-0.025389845612876154;-0.23687791980150438;-0.12141321157670393;0.33819023628753425;0.79665098964343883;-0.9372840650568427;1.4378868229528716];
IW1_1 = [-0.094190545821963234 0.080430880694117385 -0.90571967080696547 0.22788542412565044 -0.66112589911726483 -0.83696193078382608 -0.70831534954376019 -0.65879660928850603 -0.36981983868859281 0.039482571633029061 0.11236625786053481 -0.68058142833853341 0.21836018777957256 0.081754948175391584 0.27231618922894246 0.53481835391711396 -0.49386666960022785 0.14015113548798946 -0.10705025015473396 -1.0423220170926597 0.48224893445293843 -0.05510464512068694 -0.13609889240422676 -0.0011490484454251488 -0.51264749726471404 -0.19410323340029839 -1.4896214844927029 -0.21640103018990275 -0.37655262106136195 -0.827865226473251 -1.3091882994563895 -0.53531733459340869 -0.057257058604869418 0.52213987531689954 0.49721791380662378 0.0091175073746704999 0.025338059296599613 0.23776266350158728 0.20776234353287609 0.34972606650924876 0.70796627533801204 0.54804817107081305 0.050110338699808292 0.11294466849006995 0.3441022888307077 -0.017094401589050463 0.26513382739469404 -0.09152164814463061;-0.076476730732063944 0.33272969775171757 -0.038944153256365424 0.14332118062531193 -0.093472022574331223 -0.23975615422588722 0.041093266188314735 -0.21212488489970602 -0.023327006959023615 0.66106869720627393 0.094350112462095667 -0.70105249246099011 -0.17119944004363566 -0.23958600756206774 -0.016955288671981383 0.19758562179879258 0.10302267769168029 -0.20940676969874067 -0.54796957958144477 -0.13897762341535852 -0.39286934570489679 -0.45659551826741029 -0.65549277411424745 -0.0072934457780436477 -0.56005168812344108 0.015212447786062172 -0.25578453425816033 -0.34165798887482296 0.26826348727245852 -0.66471809922377467 -0.66824311569533479 -0.30845989784988398 -0.14988563375336394 0.25947497703130767 0.43210457680187897 -0.0065202529007470965 -0.068805599969249981 0.13848313839543985 0.13786551479803011 0.46755903883009065 0.81284883274041364 0.28468664835215707 0.2964461430487384 0.13139677600783461 0.22428043972957748 0.26010055498477258 -0.070854693160006255 0.50949508234941798;0.4203597829269079 -0.082820099756483481 -0.0073415948248767848 0.6122083566069727 0.16935456327835557 0.23188447005652249 -0.084701283221421952 0.44020542149431413 0.027576377591942265 -0.09081865433012426 -0.22456941620699974 -0.4768278020109763 -0.16317261695463564 0.22346338899545382 -0.087386872299097751 0.4165032371029368 0.47253065084304219 -0.25180106244001543 -0.70217797304480911 0.39683831846014939 -0.39938902520956232 -0.20990914486691065 -0.40090472646549274 -0.11334076918708928 -0.12339299517649342 0.67854458424232289 0.082471936527323278 0.11568458734235416 0.43745055235976649 -0.025618592838585426 -0.032946618989970922 0.39431839757248693 0.41798994930301892 0.28758743134370196 0.34352591547017319 0.28779706298090812 -0.23402341245578942 -0.016720732319567728 0.35306486830807166 0.29741162773446395 0.13628088363005877 0.1561764560964656 0.40495033212583931 0.10764701792525584 0.25273422722553401 0.19020055547367071 0.50017123395501129 0.49647955893691698;0.31927368382320709 0.29750266390723928 0.15785141220844481 0.074660087105946335 0.40104084474172258 0.051553737724445776 0.25505847122044784 0.069380800090910646 0.18112885418278468 -0.029779784756667076 0.019130222823400701 -0.12037703210711197 -0.19971183283482832 0.15902655169459981 -0.44419753715729876 0.0016407090911786961 0.3460088727272978 -0.34811819657941157 0.043696108664898391 0.21923993293406371 -0.12274056432988703 -0.50963163769210518 -0.20950309721039026 -0.46190639421726853 0.13621680878149017 0.24435038462968015 0.56156640504596644 -0.13956845109984012 0.3734743533134634 -0.12850421810599144 0.3605054693130994 0.37221502465873552 -0.28793992765403859 -0.17905392955136026 0.30916019432020631 -0.078319478486982369 0.42218670757971499 0.20065300077615891 -0.18337410169018342 -0.11105620722621116 0.46806081462899163 -0.12831210769966664 0.57496754136959416 0.26760667637089175 0.34931487628889235 0.60419927818910091 -0.0026691135936519825 0.17401284455326776;-0.13310975705044673 -0.034001322232763802 -0.24419838051659629 -0.21576476357662755 0.040743485866794785 -0.3048550646384231 -0.15552170609513397 -0.0023035142266231087 0.36936633725308965 -0.099409532304643805 0.3113927491715423 -0.19267782907778766 -0.079507828511351214 0.25238471622227293 -0.17077549522615385 -0.15295880267938908 -0.2563385624095732 0.21441871250544747 -0.04515697416808713 0.067305538374447749 0.55978373256176062 0.45066118558610258 0.1503751046769112 0.17836175805429741 -0.37949062711046966 -0.25886538882766341 -0.40307218282968388 0.07689900778335991 0.031832526116689713 -0.18095675646749834 0.26637815721565794 -0.54188849852548637 -0.35544538089072231 -0.44115810414125606 -0.23320535190813099 0.36100349265701653 -0.07252411037827633 -0.20864419792969141 -0.26267984314513937 -0.25251397704620843 -0.17558972736372883 -0.50641565307360137 -0.42068366380400113 -0.28580214793383191 -0.067007080879683656 -0.042075661544826656 -0.46106692720472492 -0.43500619006613528;-0.23826434207718428 -0.51085738839260397 -0.70793278103391422 -0.375282838862385 -0.16024757464680806 -0.07358857800646644 -0.26746819521529802 0.023876856257822855 -0.13375359446479027 0.17387240386503028 0.021530875212826942 -0.24140471842367081 0.41176448641485702 -0.19005263586502769 -0.0019189827397452397 0.22062882664601485 -0.38196868394579087 0.56267441442405297 0.4870634627255388 -0.59403274648427296 0.29403914294879163 0.12792883778167921 0.67819764889751166 0.51816983160828411 0.1271600478494338 -0.62668294202391017 -0.27975948120593774 -0.34394992401582924 0.12431565084453547 -0.086830154963666806 -0.60470328098411286 -0.25313488384787347 0.11473562973579955 -0.36715505960520328 -0.045474850489144097 0.26198590690287865 -0.15433618559411674 -0.10241788759494164 -0.27357505307097407 0.016384136135115458 -0.49855640506036142 -0.54981827617864532 -0.39370330489894101 -0.18934261454741866 -0.16360137062520827 -0.58054459852200391 -0.66514006615447718 -0.50313325087873939;-0.34447392381252173 -0.27007172917095773 0.58893577749967352 -0.21180061694342731 -0.061676503859228085 0.89755402275097218 0.64720539893099738 0.33176599545938645 0.25911152501013474 -0.80699949506322965 0.19034202116594554 0.43532793068596554 -0.24095451497347889 -0.28707414129766978 -0.14451781462663804 -0.34500334861634085 0.60870253468443369 -0.37388052921636439 0.094706255066925524 0.80869360450071126 -0.47807787072376573 -0.079598652977408507 0.2136225880199514 -0.081535396293722445 0.64203860139427149 0.22285147633296098 1.2745539794267036 0.017673150092809217 -0.061019049734279768 0.76434400538379954 0.47851527410988692 0.80909516918159952 0.29060868040367216 -0.3609886018448123 -0.39174931189191059 0.1494774962948088 -0.2547834525585958 0.20648264396236252 -0.079505053843517318 -0.033247918762406327 -0.73584965926969692 -0.27829689978783478 0.23593441424253891 -0.16150613992199775 0.008837317738906357 0.13990163922060372 -0.28271181527168265 -0.30549500320324124;0.19543903648023433 -0.33522924555503419 -0.2373885616514729 0.0020893690252607277 -0.36937870967892472 0.031474956784171081 -0.25614859434940346 -0.025982681103071729 0.030868494576266496 -0.37190228551863558 -0.3181909857762269 -0.40181432403456169 -0.35066767249347536 -0.020045596430778991 0.054643661524676951 -0.23794125457610169 -0.12447941399732054 0.0033270375987884621 -0.22237453512291394 -0.13035102381643074 -0.24904649316737879 -0.17233158159945616 0.125761580758185 -0.26442967528267586 -0.079892076197613376 -0.00925265814818973 0.14495742790452237 0.11635437749289838 -0.17706711914473885 0.15403329974385996 -0.10861246427147506 -0.36631522636805397 -0.020843510123563162 0.2443477273292019 -0.042589899438307113 -0.35558518858593796 0.37051909907371389 -0.32587279341174819 -0.12843809678683543 -0.14632128765015015 0.092395213687878952 0.02297900575891576 -0.31035893903103967 0.15139735412335986 -0.21177322889947395 -0.10326345290267044 -0.24799428492033174 0.23454263308803625;-0.34260475174389537 -0.16044932796739395 0.23469711595196144 -0.19102288409175844 0.098673770351086654 0.065828559560630884 -0.13023118289045613 -0.16860790979556253 0.10085422764018376 -0.054722808517761935 -0.13055457088245151 0.56705204271451115 0.19827788128320781 -0.29059331771032393 -0.18340451527134216 0.094921704853491995 -0.10549688408999747 0.13732810087750874 0.26750659462063758 0.67665598932074922 0.58652441347435957 0.24946252384447851 0.79472836179217843 0.40870470223819921 0.51500466315571503 -0.095796809283649142 0.68178054727792126 0.36083180143581473 -0.40037420136038382 0.51212652654634849 0.60659505115064771 -0.06696267664198155 0.12988358340565148 -0.42613288403268795 -0.13628588400437214 -0.066001338059737458 0.15900051359709144 -0.29017671058250272 -0.40878811293279005 -0.35602639646091849 -0.50844322461971236 -0.40911016471914891 -0.17582540631036656 -0.11622735105418489 -0.13326386414783772 -0.30627412493473838 -0.23055152999814774 -0.26154284539678696;0.16211313189269069 0.039870820764276914 0.36854447705575633 0.2186843309179945 -0.063950998035959883 0.074127974850257808 -0.44526720365508343 0.20068499349080238 0.087440231563815252 -0.34307952607964448 -0.19421299122005731 0.10345730672955274 -0.022357547847306734 0.072892177111244683 0.37443835558762878 -0.30420998056277238 -0.071266622263742391 -0.37539154121843787 0.087799701214501452 -0.2336910798635233 -0.069749856772876859 -0.10430716450709447 0.059742166373931836 -0.058872973252258681 -0.23838257059870083 0.010934861977051081 -0.11990702080844376 0.040224365222987876 0.037337573478711292 0.32580941401006053 0.00045680047973574147 -0.28633255085028875 0.00936578489790078 0.1759773258820285 -0.22191595328110644 -0.20409324884296207 0.41700197626730406 -0.2634252581050287 0.22840667984725802 0.059043203929072564 0.0940285650295139 -0.29583927281942812 -0.35356506135991173 0.26630502255522687 0.23773065274598526 0.031900958277191672 -0.13649727605741502 0.091692993244287049];

% Layer 2
b2 = [0.013941165462216592;-0.070910584074847766;0.15773267655486245];
LW2_1 = [-1.3625717080308919 1.3980508809704315 2.5738262167200223 0.59326738676033741 -2.0461214024058045 -2.4852065005232493 1.6770518249822615 0.51355267347065803 -0.81058033745304181 0.53261884530256176;-3.1658098360664351 -1.5973909477654669 -0.95249744556941762 -1.7606446772423472 0.22391465691684165 1.481987191862888 1.9372312582144349 0.92668525894802434 2.0239002209958312 -0.2414135024631478;4.2683808449285054 1.2218821444060821 -0.47481820402248381 -1.0441818536390588 0.12682969757634105 0.74915311200817303 -2.9031360008383125 1.2413879525077203 -0.70752554231257636 0.72714529036402376];

% ===== SIMULATION ========

% Dimensions
Q = size(x1,1); % samples

% Input 1
x1 = x1';
xp1 = mapminmax_apply(x1,x1_step1);

% Layer 1
a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*xp1);

% Layer 2
a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);

% Output 1
y1 = a2;
y1 = y1';
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n,~)
if isa(n,'gpuArray')
    a = iSoftmaxApplyGPU(n);
else
    a = iSoftmaxApplyCPU(n);
end
end
function a = iSoftmaxApplyCPU(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numerator = exp(n);
denominator = sum(numerator,1);
denominator(denominator == 0) = 1;
a = bsxfun(@rdivide,numerator,denominator);
end
function a = iSoftmaxApplyGPU(n)
nmax = max(n,[],1);
numerator = arrayfun(@iSoftmaxApplyGPUHelper1,n,nmax);
denominator = sum(numerator,1);
a = arrayfun(@iSoftmaxApplyGPUHelper2,numerator,denominator);
end
function numerator = iSoftmaxApplyGPUHelper1(n,nmax)
numerator = exp(n - nmax);
end
function a = iSoftmaxApplyGPUHelper2(numerator,denominator)
if (denominator == 0)
    a = numerator;
else
    a = numerator ./ denominator;
end
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
